<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ì´íŠ¸ì•½êµ­ ê´€ë¦¬ì (High Quality & Scale)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì „ì²´ ìœ ì§€ */
        body { font-family: 'Noto Sans KR', sans-serif; padding: 20px; background: #f4f4f4; max-width: 800px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 20px; }
        .header-title h1 { color: #1D5C36; margin: 0; font-size: 1.5rem; }
        .header-title p { color: #666; margin: 5px 0 0 0; font-size: 0.9rem; }
        .btn-settings { background: none; border: 2px solid #666; color: #666; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .btn-settings:hover { background: #666; color: white; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 9999; display: none; justify-content: center; align-items: center; flex-direction: column; overflow-y: auto; }
        .modal-box { background: white; padding: 30px; border-radius: 10px; text-align: center; width: 350px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); margin: 20px 0; }
        .modal-input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 0.9rem; box-sizing: border-box; }
        .modal-btn { width: 100%; padding: 12px; background: #1D5C36; color: white; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; font-weight: bold; margin-top: 10px;}
        .modal-btn-close { background: #888; margin-top: 5px; }
        .coord-section { background:#f5f5f5; padding:15px; border-radius:8px; border:1px solid #eee; margin-bottom:15px; }
        .coord-title { font-weight:bold; color:#333; margin-bottom:8px; display:block; text-align:left; border-bottom:1px solid #ddd; padding-bottom:5px; margin-top:10px; }
        .coord-row { display: flex; gap: 10px; margin-bottom: 5px; align-items: center; }
        .coord-item { flex: 1; display: flex; align-items: center; gap: 5px; }
        .coord-tag { font-size: 0.8rem; font-weight: bold; color: #555; width: 15px; } 
        .coord-item input { width: 100%; padding: 8px; font-size: 0.9rem; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        .tab-menu { display: flex; background: #fff; border-radius: 8px 8px 0 0; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: #f0f0f0; cursor: pointer; font-size: 1rem; font-weight: bold; color: #555; border-bottom: 3px solid transparent; }
        .tab-btn.active { background: #fff; color: #1D5C36; border-bottom: 3px solid #1D5C36; }
        .tab-content { display: none; background: #fff; padding: 25px; border-radius: 0 0 8px 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .tab-content.active { display: block; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #333; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 80px; resize: vertical; }
        #desc_kr { height: 160px; border: 2px solid #6366f1; background-color: #f8f8ff; }
        .row { display: flex; gap: 10px; } .col { flex: 1; }
        .btn { background-color: #1D5C36; color: white; padding: 15px; width: 100%; border: none; border-radius: 5px; font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn:hover { background-color: #144226; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .btn-reset { background-color: #666; margin-bottom: 20px; }
        .btn-reset:hover { background-color: #444; }
        .ai-btn { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 3px 10px rgba(139, 92, 246, 0.3); transition: transform 0.2s; width: 100%; margin-bottom: 15px; }
        .ai-btn:hover { transform: scale(1.02); }
        .qr-section { border: 2px dashed #1D5C36; background-color: #f9fff9; padding: 15px; border-radius: 8px; margin-top: 30px; }
        .preview-img { max-width: 200px; margin-top: 10px; display: none; border: 1px solid #ddd; border-radius: 4px;}
        .section-header { font-size: 1.1rem; font-weight: bold; margin: 30px 0 10px 0; color: #333; border-left: 5px solid #1D5C36; padding-left: 10px; }
        .product-item { display: flex; align-items: center; background: #fafafa; padding: 15px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #eee; gap: 15px; }
        .item-img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #eee; }
        .item-info { flex: 1; }
        .item-title { font-weight: bold; font-size: 1.1rem; color: #333; margin-bottom: 4px; display: flex; align-items: center; gap: 5px;}
        .item-price { color: #d32f2f; font-weight: bold; }
        .btn-group { display: flex; gap: 5px; }
        .btn-small { padding: 8px 12px; font-size: 0.9rem; border-radius: 4px; cursor: pointer; border: none; color: white; }
        .btn-edit { background-color: #f39c12; } .btn-delete { background-color: #c0392b; } .btn-view { background-color: #3498db; } .btn-tag { background-color: #673ab7; color: white; } .btn-tag:hover { background-color: #512da8; }
        #qrCodeContainer { display: none; }
        .badge-id { font-size: 0.8rem; background: #eee; padding: 2px 6px; border-radius: 4px; color: #666; }
        .badge-qr-on { font-size: 0.75rem; background: #e8f5e9; color: #1D5C36; border: 1px solid #1D5C36; padding: 2px 8px; border-radius: 20px; font-weight: bold; cursor: pointer; display: inline-flex; align-items: center; gap: 3px; transition: all 0.2s;}
        .badge-qr-on:hover { background: #1D5C36; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .badge-qr-off { font-size: 0.75rem; background: #fff3e0; color: #ef6c00; border: 1px solid #ef6c00; padding: 2px 6px; border-radius: 10px; font-weight: normal; cursor: default;}
        .badge-view { font-size: 0.8rem; color: #555; display: flex; align-items: center; gap: 3px; background: #fff; padding: 2px 8px; border-radius: 10px; border: 1px solid #ddd; }
        .dash-card { background:#fff; border:1px solid #eee; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.05); }
        .dash-title { font-size:1.1rem; font-weight:bold; color:#333; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center; }
        .chart-box { height: 250px; position: relative; display: flex; justify-content: center; align-items: center;}
        .legend-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #eee; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; color: #555; }
        .legend-color { width: 12px; height: 12px; border-radius: 3px; flex-shrink: 0; }
        .stat-grid { display:flex; gap:15px; }
        .stat-item { flex:1; background:#f8f9fa; padding:15px; border-radius:8px; text-align:center; }
        .stat-num { font-size:2rem; font-weight:bold; color:#1D5C36; display:block; }
        .stat-label { font-size:0.9rem; color:#666; }
        .date-filter { background: #fff; border: 1px solid #1D5C36; border-radius: 8px; padding: 10px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; justify-content: center; }
        .date-input { padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-family: 'Noto Sans KR'; }
        .log-container { background: #333; color: #fff; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; }
        .log-item { border-bottom: 1px solid #444; padding: 5px 0; display: flex; justify-content: space-between; }
        .log-time { color: #888; margin-right: 10px; }
        .log-action { color: #4caf50; font-weight: bold; } 
        .log-product { color: #fff; }
    </style>
</head>
<body>
    <canvas id="priceTagCanvas" width="2031" height="1252" style="display:none;"></canvas>
    <div id="loginOverlay" class="overlay" style="display:flex;"><div class="modal-box"><h2 style="color:#1D5C36; margin-bottom:10px;">ê´€ë¦¬ì ë¡œê·¸ì¸</h2><p style="color:#666; margin-bottom:20px;">ìƒí’ˆ ê´€ë¦¬ ê¶Œí•œ í™•ì¸</p><input type="password" id="adminPassword" class="modal-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"><button class="modal-btn" onclick="checkLogin()">ì ‘ì†í•˜ê¸°</button></div></div>
    
    <div id="settingsOverlay" class="overlay">
        <div id="settingsAuthBox" class="modal-box"><h3 style="margin-top:0;">ğŸ” ìŠˆí¼ë°”ì´ì € ì¸ì¦</h3><input type="password" id="supervisorPassword" class="modal-input" placeholder="ìŠˆí¼ë°”ì´ì € ë¹„ë°€ë²ˆí˜¸"><button class="modal-btn" onclick="checkSupervisorLogin()">í™•ì¸</button><button class="modal-btn modal-btn-close" onclick="closeSettings()">ì·¨ì†Œ</button></div>
        <div id="settingsConfigBox" class="modal-box" style="display:none; width: 450px; max-height:90vh; overflow-y:auto;">
            <h3 style="margin-top:0;">âš™ï¸ ì‚¬ì´íŠ¸ ê¸°ë³¸ ì„¤ì •</h3>
            <div style="text-align:left; margin-top:10px; padding-bottom:10px;"><label style="font-size:0.9rem;">ğŸ”‘ OpenAI API Key</label><input type="text" id="configApiKey" class="modal-input" placeholder="sk-..." style="font-size:0.9rem;"></div>
            <div style="text-align:left; margin-top:10px; border-bottom:1px solid #eee; padding-bottom:15px;"><label style="font-size:0.9rem; color:#1D5C36;">ğŸ’° Tax Refund ì˜ˆìƒ í™˜ê¸‰ë¥  (%)</label><input type="number" id="configRefundRate" class="modal-input" placeholder="ì˜ˆ: 6.5" style="font-size:0.9rem;" step="0.1"></div>
            <div style="text-align:left; padding-bottom:10px;"><label style="font-size:0.9rem; color:#673ab7;">ğŸ–¼ï¸ ë°°ê²½ ì´ë¯¸ì§€</label><input type="file" id="bgFileInput" accept="image/*" style="font-size:0.9rem;"><p id="bgStatus" style="font-size:0.8rem; color:#888; margin: 2px 0;">ìƒíƒœ: í™•ì¸ ì¤‘...</p></div>
            
            <div class="coord-section">
                <h4 style="margin:0 0 10px 0; color:#1D5C36; text-align: left;">ğŸ“ ê°€ê²©í‘œ ë ˆì´ì•„ì›ƒ ë¯¸ì„¸ì¡°ì •</h4>
                <span class="coord-title">ğŸ“¦ ìƒí’ˆ ì´ë¯¸ì§€ (ì™¼ìª½)</span>
                <div class="coord-row"><div class="coord-item"><span class="coord-tag">X</span><input type="number" id="layout_prod_x"></div><div class="coord-item"><span class="coord-tag">Y</span><input type="number" id="layout_prod_y"></div></div>
                <div class="coord-row">
                    <div class="coord-item"><span class="coord-tag">W</span><input type="number" id="layout_prod_w" placeholder="ìµœëŒ€í­"></div>
                    <div class="coord-item"><span class="coord-tag">H</span><input type="number" id="layout_prod_h" placeholder="ìµœëŒ€ë†’ì´"></div>
                </div>
                <div class="coord-row" style="margin-top:5px; border-top:1px dashed #ddd; padding-top:5px;">
                    <div class="coord-item"><span class="coord-tag" style="width:35px; color:#d32f2f;">Scale</span><input type="number" id="layout_prod_scale" placeholder="ê¸°ë³¸ 1.0" step="0.1"></div>
                </div>

                <span class="coord-title">ğŸ“· QR ì½”ë“œ (ì˜¤ë¥¸ìª½ ìƒë‹¨)</span>
                <div class="coord-row"><div class="coord-item"><span class="coord-tag">X</span><input type="number" id="layout_qr_x"></div><div class="coord-item"><span class="coord-tag">Y</span><input type="number" id="layout_qr_y"></div></div>
                <div class="coord-row"><div class="coord-item"><span class="coord-tag" style="width:30px">Size</span><input type="number" id="layout_qr_size" placeholder="í¬ê¸°"></div></div>
                <span class="coord-title">ğŸ’° ê°€ê²© (ì˜¤ë¥¸ìª½ í•˜ë‹¨)</span>
                <div class="coord-row"><div class="coord-item"><span class="coord-tag">X</span><input type="number" id="layout_price_x"></div><div class="coord-item"><span class="coord-tag">Y</span><input type="number" id="layout_price_y"></div></div>
                <div class="coord-row"><div class="coord-item"><span class="coord-tag" style="width:30px">Size</span><input type="number" id="layout_price_size" placeholder="ê¸€ìí¬ê¸°"></div></div>
            </div>

            <div style="text-align:left; margin-top:15px;"><label style="font-size:0.9rem; color:#d32f2f;">ğŸ›¡ï¸ ê´€ë¦¬ì ë¹„ë²ˆ ë³€ê²½</label><input type="text" id="configAdminPw" class="modal-input" placeholder="0000"></div>
            <button class="modal-btn" onclick="saveSettings()">ëª¨ë“  ì„¤ì • ì €ì¥í•˜ê¸°</button>
            <button class="modal-btn modal-btn-close" onclick="closeSettings()">ë‹«ê¸°</button>
        </div>
    </div>

    <header><div class="header-title"><h1>ğŸ’Š EIGHT PHARMACY ADMIN</h1><p>ìƒí’ˆ ë“±ë¡ ë° QRì½”ë“œ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p></div><button class="btn-settings" onclick="openSettings()">âš™ï¸ ì„¤ì •</button></header>
    <div class="tab-menu"><button class="tab-btn" onclick="openTab('tab-dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button><button class="tab-btn active" onclick="openTab('tab-register')">ğŸ“ ìƒí’ˆ ë“±ë¡</button><button class="tab-btn" onclick="openTab('tab-manage')">ğŸ“‹ ìƒí’ˆ ê´€ë¦¬</button></div>
    
    <div id="tab-dashboard" class="tab-content"><div class="date-filter"><span style="font-weight:bold;">ğŸ“… ê¸°ê°„ ì¡°íšŒ (KST)</span><input type="date" id="startDate" class="date-input"><span>~</span><input type="date" id="endDate" class="date-input"><button class="btn-small" style="background:#1D5C36;" onclick="loadDashboard()">ğŸ” ì¡°íšŒ</button></div><div class="stat-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;"><div class="stat-item"><span class="stat-label">ğŸ“¦ ì´ ìƒí’ˆìˆ˜</span><span class="stat-num" id="statTotalProducts">0</span></div><div class="stat-item"><span class="stat-label">ğŸ‘€ ì¡°íšŒìˆ˜</span><span class="stat-num" id="statPeriodViews" style="color:#d32f2f;">0</span></div><div class="stat-item"><span class="stat-label">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</span><span class="stat-num" id="statCartAdds" style="color:#2980b9;">0</span></div><div class="stat-item"><span class="stat-label">ğŸ“ˆ ì „í™˜ìœ¨</span><span class="stat-num" id="statConversion" style="color:#8e44ad;">0%</span></div></div><br><div class="row"><div class="col dash-card"><div class="dash-title">â° ì‹œê°„ëŒ€ë³„ ë°©ë¬¸ ì¶”ì´</div><div class="chart-box"><canvas id="chartHourly"></canvas></div></div><div class="col dash-card"><div class="dash-title">ğŸ† ê¸°ê°„ ë‚´ ì¸ê¸° ìƒí’ˆ (Top 5)</div><div class="chart-box"><canvas id="chartProducts"></canvas></div></div></div><div class="row"><div class="col dash-card"><div class="dash-title">ğŸŒ ì–¸ì–´ë³„ ê´€ì‹¬ë„</div><div class="chart-box"><canvas id="chartLangs"></canvas></div><div id="customLegend" class="legend-grid"></div></div><div class="col dash-card"><div class="dash-title"><span>ğŸ“œ ì‹¤ì‹œê°„ ë¡œê·¸</span><button class="btn-small" style="background:#27ae60;" onclick="downloadExcel()">ğŸ“¥ ì—‘ì…€ ì €ì¥</button></div><div id="logContainer" class="log-container"><div style="text-align:center; padding-top:80px; color:#888;">ë°ì´í„° ë¡œë”© ì¤‘...</div></div></div></div></div>
    <div id="tab-register" class="tab-content active"><button class="btn btn-reset" onclick="resetForm()">ğŸ”„ ì…ë ¥ì°½ ë¹„ìš°ê¸° (ì‹ ê·œ ë“±ë¡)</button><div class="input-group"><label>ìƒí’ˆ ID (ìë™ìƒì„±)</label><input type="text" id="productId" placeholder="tylenol" readonly style="background-color: #e0e0e0; color: #555; cursor: not-allowed; font-weight: bold;"></div><div class="row"><div class="col input-group"><label>ìƒí’ˆëª…</label><input type="text" id="name" placeholder="íƒ€ì´ë ˆë†€"></div><div class="col input-group"><label>ê°€ê²©</label><input type="number" id="price" placeholder="3500"></div></div><div class="input-group"><label>ì´ë¯¸ì§€</label><input type="file" id="imageFile" accept="image/*"><img id="preview" class="preview-img"></div><div class="section-header">ğŸŒ ìƒì„¸ ì„¤ëª…</div><div class="lang-section" style="border:2px solid #6366f1; background:#f0f0ff;"><div class="lang-title">ğŸ‡°ğŸ‡· í•œêµ­ì–´</div><textarea id="desc_kr" placeholder="ì„¤ëª… ì…ë ¥"></textarea></div><button class="ai-btn" onclick="translateContent()">âœ¨ AI ë²ˆì—­</button><div class="section-header">ğŸ¤– ë²ˆì—­ ê²°ê³¼</div><div class="lang-section"><div class="lang-title">ğŸ‡ºğŸ‡¸ ì˜ì–´</div><textarea id="desc_en"></textarea></div><div class="lang-section"><div class="lang-title">ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´</div><textarea id="desc_jp"></textarea></div><div class="lang-section"><div class="lang-title">ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´</div><textarea id="desc_cn"></textarea></div><div class="lang-section"><div class="lang-title">ğŸ‡¹ğŸ‡­ íƒœêµ­ì–´</div><textarea id="desc_th"></textarea></div><div class="lang-section"><div class="lang-title">ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨ì–´</div><textarea id="desc_vn"></textarea></div><div class="lang-section"><div class="lang-title">ğŸ‡®ğŸ‡© ì¸ë„ë„¤ì‹œì•„ì–´</div><textarea id="desc_id"></textarea></div><div class="lang-section"><div class="lang-title">ğŸ‡²ğŸ‡³ ëª½ê³¨ì–´</div><textarea id="desc_mn"></textarea></div><div class="input-group qr-section"><label style="color:#1D5C36;">ğŸ“· QR ì½”ë“œ</label><div style="display:flex; align-items:flex-end; gap:15px; margin-top:10px;"><img id="qrPreview" class="preview-img" style="display:none;"><div id="qrPlaceholder" style="color:#999; font-size:0.9rem;">(ìë™ ìƒì„±)</div><a id="qrDownloadBtn" class="btn-small btn-view" style="display:none;">ğŸ’¾ ë‹¤ìš´</a></div><div id="qrCodeContainer"></div></div><button class="btn" onclick="saveProduct()" id="saveBtn">ì €ì¥í•˜ê¸°</button></div>
    <div id="tab-manage" class="tab-content"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;"><h3 style="margin:0;">ìƒí’ˆ ë¦¬ìŠ¤íŠ¸</h3><button class="btn-small" style="background:#666;" onclick="loadProductList()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button></div><div style="display:flex; gap:10px; margin-bottom:20px;"><select id="sortSelect" style="padding:12px; border:2px solid #1D5C36; border-radius:10px; font-size:1rem;" onchange="applySort()"><option value="newest">ğŸ•’ ìµœì‹  ë“±ë¡ìˆœ</option><option value="oldest">ğŸ“… ì˜¤ë˜ëœ ìˆœ</option><option value="name_asc">ğŸ”¤ ê°€ë‚˜ë‹¤ìˆœ</option><option value="name_desc">ğŸ”  ê°€ë‚˜ë‹¤ ì—­ìˆœ</option><option value="views">ğŸ”¥ ì¡°íšŒìˆ˜ ìˆœ</option></select><input type="text" id="searchInput" placeholder="ğŸ” ê²€ìƒ‰..." style="flex:1; padding:12px; border:2px solid #1D5C36; border-radius:50px;"></div><div id="productList"><p style="text-align:center;">ë¡œë”© ì¤‘...</p></div></div>

    <script>
        const now = new Date();
        const kstOffset = 9 * 60 * 60 * 1000;
        const kstDate = new Date(now.getTime() + kstOffset);
        const today = kstDate.toISOString().split('T')[0];
        document.getElementById('startDate').value = today;
        document.getElementById('endDate').value = today;
        function openTab(tabName) { document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.getElementById(tabName).classList.add('active'); event.currentTarget.classList.add('active'); if(tabName === 'tab-manage') loadProductList(); if(tabName === 'tab-dashboard') loadDashboard(); }
    </script>
    <script type="module" src="./admin.js"></script>
    <script type="module"> const originalEdit = window.editProduct; window.editProduct = async function(id) { document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.getElementById('tab-register').classList.add('active'); document.querySelector('.tab-btn:nth-child(2)').classList.add('active'); if (typeof originalEdit === 'function') originalEdit(id); } </script>
</body>
</html>