<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïû•Î∂Ä ÏÉÅÏÑ∏ Ï°∞Ìöå |<span class="pharmacy-name-display"></span></title>
    <link rel="stylesheet" href="common.css">       <link rel="stylesheet" href="style-ledger.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.css"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<header>
    <a href="index.html" class="logo">
        <i class="fas fa-capsules"></i> <span class="pharmacy-name-display"></span>
    </a>
    <nav class="nav-links">
        <a href="index.html" class="menu-btn">Ìôà</a>
        <a href="ledger.html" class="menu-btn active">Ïû•Î∂Ä</a>
        <a href="settings.html" class="menu-btn">ÏÑ§Ï†ï</a>
    </nav>
</header>

<div class="container">
    
    <main class="ledger-wrapper">
        
        <div class="ledger-paper">

            <div class="ledger-header-control">
                <div class="filter-group">
                    <select id="vendorFilter" onchange="filterLedger()" 
        style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 220px; font-size: 0.9rem;">
                        <option value="all">Ï†ÑÏ≤¥ Í±∞ÎûòÏ≤ò</option>
                    </select>
                    
                    <div class="date-range-picker" style="display:inline-flex; align-items:center; gap:5px; margin-left:10px;">
                        <input type="date" id="startDate" onchange="filterLedger()">
                        <span>~</span>
                        <input type="date" id="endDate" onchange="filterLedger()">
                    </div>
                </div>
                </div>

            <div class="ledger-summary-bar">
                <div class="summary-item blue">
                    <span>Ï¥ù Îß§ÏûÖÏï° (ÏûÖÍ≥†)</span>
                    <strong id="sumBuy" class="val-blue">0</strong>
                </div>
                <div class="summary-item red">
                    <span>Ï¥ù Í≤∞Ï†úÏï° (ÏßÄÏ∂ú)</span>
                    <strong id="sumPay" class="val-red">0</strong>
                </div>
                <div class="summary-item green">
                    <span>ÌòÑÏû¨ ÏûîÏï° (ÏµúÏ¢Ö)</span>
                    <strong id="sumBalance" class="val-green">0</strong>
                </div>
            </div>

            <div class="table-container-card">
                <table class="data-grid" id="ledgerTable">
                    <colgroup>
                        <col style="width: 170px;"> <col style="width: 80px;">  <col style="width: 110px;"> 
                        
                        <col style="width: auto;">  
                        
                        <col style="width: 70px;">  <col style="width: 100px;"> <col style="width: 90px;">  <col style="width: 110px;"> <col style="width: 110px;"> <col style="width: 110px;"> <col style="width: 50px;">  <col style="width: 90px;">  
                        </colgroup>
                   <thead>
                        <tr>
                            <th style="width: 100px; text-align: center;">ÎÇ†Ïßú</th> <th style="width: 60px; text-align: center;">Íµ¨Î∂Ñ</th>
                            <th style="width: 120px; text-align: center;">Í±∞ÎûòÏ≤ò</th>
                            <th style="min-width: 250px; text-align: center;">Ï†ÅÏöî(Î©îÎ™®)</th> <th style="width: 50px; text-align: center;">ÏàòÎüâ</th>
                            <th style="width: 90px; text-align: center;">Í≥µÍ∏âÍ∞Ä</th>
                            <th style="width: 80px; text-align: center;">ÏÑ∏Ïï°</th>
                            <th style="width: 100px; text-align: center;">ÏûÖÍ≥†Ïï°</th>
                            <th style="width: 100px; text-align: center;">ÏßÄÏ∂ú/Î∞òÌíà</th>
                            <th style="width: 110px; text-align: center;">ÏûîÏï°</th>
                            <th style="width: 45px; text-align: center;">Ï¶ùÎπô</th>
                            <th style="width: 60px; text-align: center;">Í¥ÄÎ¶¨</th>
                        </tr>
                    </thead>
                    <tbody id="ledgerTableBody">
                        <tr><td colspan="12" class="text-center" style="padding:50px; color:#999;">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</td></tr>
                    </tbody>
                    <tfoot>
                        <tr class="entry-row">
                            <td>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-bolt" style="color:#f59f00; font-size:1.1rem; animation: pulse 2s infinite;"></i>
                                    <input type="date" id="qDate" style="flex:1; text-align: center;">
                                </div>
                            </td>
                            <td style="width: 70px;">
                                <select id="qType" onchange="toggleQuickPayment()">
                                    <option value="buy">ÏûÖÍ≥†</option>
                                    <option value="pay">Í≤∞Ï†ú</option>
                                    <option value="return">Î∞òÌíà</option>
                                </select>
                            </td>
                            <td style="width: 120px;"><input type="text" id="qVendor" placeholder="Í±∞ÎûòÏ≤ò" list="vendorList"></td>
                            
                            <td style="min-width: 250px;"><input type="text" id="qMemo" placeholder="ÎÇ¥Ïö©(Ï†ÅÏöî)" style="width: 100%;"></td>
                            
                            <td style="width: 60px;"><input type="number" id="qQty" placeholder="0"></td>
                            <td style="width: 90px;"><input type="text" id="qSupply" class="money-input" placeholder="Í≥µÍ∏âÍ∞Ä" onkeyup="formatCurrency(this); calcQuickSupply();"></td>
                            <td style="width: 80px;"><input type="text" id="qVat" class="money-input" placeholder="ÏÑ∏Ïï°" onkeyup="formatCurrency(this); calcQuickVat();"></td>
                            <td style="width: 100px;"><input type="text" id="qTotal" class="money-input" placeholder="Ìï©Í≥Ñ" onkeyup="formatCurrency(this); calcQuickTotalReverse();" style="font-weight:bold; color:#2563eb;"></td>
                            
                            <td colspan="3" style="background:transparent;"></td>
                            <td>
                                <button class="btn-quick-add" onclick="addQuickItem()">
                                    <i class="fas fa-plus"></i> Ï∂îÍ∞Ä
                                </button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div id="paginationControls" class="pagination-container"></div>
        </div> </main>
</div>
        

<div id="editModal">
    <div class="modal-new-box"> <h3 style="margin-top:0; border-bottom:2px solid #f1f5f9; padding-bottom:15px; margin-bottom:25px;">üìã ÎÇ¥Ïó≠ ÏÉÅÏÑ∏ ÏàòÏ†ï</h3>
        
        <input type="hidden" id="editDocId">
        
        <div style="display:grid; grid-template-columns: 1fr 1fr 1.5fr; gap:15px; margin-bottom:20px;">
            <div><label style="display:block; font-size:0.8rem; margin-bottom:5px;">ÎÇ†Ïßú</label>
                 <input type="date" id="editDate" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;"></div>
            <div><label style="display:block; font-size:0.8rem; margin-bottom:5px;">Íµ¨Î∂Ñ</label>
                 <select id="editType" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; background:white;">
                    <option value="buy">ÏûÖÍ≥†(Îß§ÏûÖ)</option>
                    <option value="pay">Í≤∞Ï†ú(ÏßÄÎ∂à)</option>
                    <option value="return">Î∞òÌíà</option>
                 </select></div>
            <div><label style="display:block; font-size:0.8rem; margin-bottom:5px;">Í±∞ÎûòÏ≤ò</label>
                 <input type="text" id="editVendor" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;"></div>
        </div>

        <div style="margin-bottom:25px;">
            <label style="display:block; font-size:0.8rem; margin-bottom:5px;">Ï†ÅÏöî(Î©îÎ™®)</label>
            <input type="text" id="editMemo" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
        </div>

        <div class="split-amount-row">
            <div><label>ÏàòÎüâ</label><input type="number" id="editQty" style="text-align:center !important;"></div>
            <div><label>Í≥µÍ∏âÍ∞Ä</label><input type="text" id="editSupply" oninput="onEditSupplyInput(this)"></div>
            <div><label>ÏÑ∏Ïï°</label><input type="text" id="editVat" oninput="onEditVatInput(this)"></div>
            <div><label style="color:#2563eb;">Ìï©Í≥Ñ(ÏûÖÍ≥†Ïï°)</label>
                 <input type="text" id="editTotalDisplay" oninput="onEditTotalInput(this)" style="border:2px solid #2563eb !important; color:#2563eb !important; font-weight:bold !important;"></div>
        </div>

        <div style="margin-top:35px; display:flex; gap:15px;">
            <button onclick="saveEdit()" style="flex:1.5; background:#2563eb; color:white; padding:16px; border-radius:10px; border:none; font-weight:bold; cursor:pointer;">Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Ï†ÄÏû•</button>
            <button onclick="closeEditModal()" style="flex:1; background:#f1f5f9; padding:16px; border-radius:10px; border:none; cursor:pointer;">Ï∑®ÏÜå</button>
        </div>
    </div>
</div>
<script src="firebase-config.js"></script>
<script src="logic-ledger.js"></script>

</body>
</html>