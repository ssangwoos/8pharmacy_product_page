<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaOrder OS</title>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
</head>
<body>

    <header class="top-header">
        <div class="logo">PharmaOrder OS</div>
        <div class="search-bar">
            <input id="main-search-input" type="text" placeholder="🔍 약품명, 성분명, 제약사 검색 (Enter)">
        </div>
        <div class="user-info">관리약사: 홍길동 님 <span style="color:#27ae60">● Online</span></div>
    </header>

    <div class="main-container">
        <nav class="panel menu-sidebar">
            <div class="pharmacy-brand-area">
                <div class="brand-logo-placeholder">🏥</div> 
                <div class="brand-name-text">에이트약국</div>
            </div>
            <div class="menu-item active" data-target="order-book">📝 주문장<span class="menu-sub-text">(Order Book)</span></div>
            <div class="menu-item" data-target="order-mgmt">통합 주문 관리</div>
            <div class="menu-item" data-target="history-mgmt">주문 기록 관리</div>
            <div class="menu-item" data-target="supplier-mgmt">거래처 관리</div>
            <div class="menu-item" data-target="return-mgmt">반품 관리</div>
            <div class="menu-item" data-target="product-mgmt">상품 관리 (Admin)</div>
            <div class="menu-item" data-target="settings">설정</div>
        </nav>

        <div id="page-order-book" class="content-group" style="display: flex; flex-direction: column; padding: 20px; overflow-y: auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #333; padding-bottom:10px;">
                <h2>📝 주문 요청 현황 (Order Note)</h2>
            </div>
            <div id="photo-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
                <div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #aaa;">불러오는 중...</div>
            </div>
        </div>

        <div id="page-order-mgmt" class="content-group" style="display: none;">
            <aside class="panel drug-list">
                <div class="panel-header">약품 분류 (List)</div>
                <div id="product-list"><div style="padding: 20px; color: #aaa; text-align: center;">데이터 로딩중...</div></div>
            </aside>
            <main class="panel product-detail">
                <div class="panel-header">상품 주문 (Order)</div>
                <div id="detail-empty" style="padding:40px; text-align:center; color:#aaa;">좌측 리스트에서<br>주문할 약품을 선택해주세요.</div>
                <div id="detail-content" style="display:none; height:100%; flex-direction:column;">
                    <div class="order-header" style="margin-bottom: 20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                            <span id="detail-category" style="font-size:0.8rem; background:#eee; padding:3px 8px; border-radius:4px; color:#555; font-weight:bold;">-</span>
                            <button id="btn-show-info-small" style="font-size:0.8rem; padding:3px 8px; background:transparent; border:1px solid #ccc; border-radius:4px; cursor:pointer; color:#555;">ℹ️ 상세정보</button>
                        </div>
                        <h2 id="detail-name" style="margin: 5px 0; color:#333;">-</h2>
                        <div id="detail-company" style="color:#7f8c8d; font-size:0.95rem;">-</div>
                    </div>
                    <div class="order-split-container" style="display:flex; gap:20px; flex-grow:1; overflow:hidden;">
                        <div class="left-option-area" style="flex:1; display:flex; flex-direction:column; overflow-y:auto;">
                            <label style="font-weight:bold; color:#555; margin-bottom:10px; display:block;">📦 주문 단위 선택</label>
                            <div id="option-list-container" style="display:flex; flex-direction:column; gap:10px;"></div>
                        </div>
                        <div class="right-action-area" style="width:200px; flex-shrink:0; display:flex; flex-direction:column; gap:15px; border-left:1px solid #eee; padding-left:20px;">
                            <div>
                                <label style="font-weight:bold; color:#555; font-size:0.9rem; display:block; margin-bottom:5px;">수량</label>
                                <div style="display:flex; align-items:center; width:100%;">
                                    <button id="qty-minus" style="width:40px; height:40px; border:1px solid #ddd; background:#f9f9f9; cursor:pointer;">-</button>
                                    <input id="order-qty" type="number" value="1" min="1" style="width:100%; text-align:center; height:40px; border:1px solid #ddd; border-bottom:1px solid #ddd; border-left:none; border-right:none; font-size:1.1rem; font-weight:bold;">
                                    <button id="qty-plus" style="width:40px; height:40px; border:1px solid #ddd; background:#f9f9f9; cursor:pointer;">+</button>
                                </div>
                            </div>
                            <div style="text-align:right;">
                                <span style="font-size:0.8rem; color:#888;">예상 금액</span>
                                <div id="order-total-price" style="font-size:1.4rem; font-weight:bold; color:#e74c3c;">0원</div>
                            </div>
                            <button id="btn-add-cart" style="width:100%; padding:15px 0; background:#3498db; color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer; font-size:1.1rem; margin-top: 20px;">장바구니 담기</button>
                        </div>
                    </div>
                </div>
            </main>
            <aside class="panel cart-area">
                <div class="panel-header">장바구니 (Cart) <span id="cart-count" style="background:#e74c3c; color:white; border-radius:50%; padding:2px 6px; font-size:0.8rem;">0</span></div>
                <div id="photo-request-queue"></div>
                <div id="undo-area" style="display:none; background:#333; color:white; padding:10px; text-align:center; font-size:0.9rem;">삭제되었습니다. <button id="btn-undo" style="margin-left:10px; border:1px solid #aaa; background:transparent; color:#fff; cursor:pointer;">실행취소</button></div>
                <div id="cart-list"><div style="padding:20px; text-align:center; color:#ccc;">비어있음</div></div>
                <div class="cart-total">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>총 주문금액</span><strong id="cart-total-price" style="color:#e74c3c; font-size:1.2rem;">0원</strong></div>
                    <button id="btn-order-complete" style="width:100%; padding:15px; background:#2c3e50; color:white; border:none; border-radius:4px; font-size:1rem; cursor:pointer;">주문 완료 (하단이동)</button>
                </div>
            </aside>
        </div>

        <div id="page-history-mgmt" class="content-group" style="display: none; padding: 20px; flex-grow: 1; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #333; padding-bottom:10px;"><h2>📅 주문 기록 조회</h2></div>
            <div style="display:flex; gap:20px; flex-grow:1; overflow:hidden;">
                <div class="calendar-wrapper" style="width:350px; flex-shrink:0; background:#fff; border:1px solid #ddd; border-radius:8px; padding:20px; display:flex; flex-direction:column;">
                    <div class="calendar-nav" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <button id="cal-prev" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">&lt;</button><strong id="cal-current-month" style="font-size:1.2rem;">2024.11</strong><button id="cal-next" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">&gt;</button>
                    </div>
                    <div class="calendar-days" style="display:grid; grid-template-columns:repeat(7, 1fr); text-align:center; margin-bottom:10px; font-weight:bold; color:#666;"><div style="color:#e74c3c">일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div style="color:#3498db">토</div></div>
                    <div id="calendar-grid" class="calendar-grid" style="display:grid; grid-template-columns:repeat(7, 1fr); row-gap:10px; text-align:center;"></div>
                </div>
                <div class="history-list-wrapper" style="flex:1; background:#fff; border:1px solid #ddd; border-radius:8px; padding:20px; display:flex; flex-direction:column;">
                    <h3 id="history-title" style="margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">날짜를 선택해주세요</h3>
                    <div id="history-list" style="flex:1; overflow-y:auto;"><div style="text-align:center; color:#ccc; margin-top:50px;">기록이 없습니다.</div></div>
                </div>
            </div>
        </div>

        <div id="page-supplier-mgmt" class="content-group" style="display: none; padding: 20px; flex-grow: 1; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:2px solid #333; padding-bottom:10px;"><h2>🏢 거래처 리스트 (<span id="sup-total-count">0</span>)</h2><button id="btn-new-supplier" style="padding:8px 15px; background:#2980b9; color:white; border:none; border-radius:4px; cursor:pointer;">+ 신규 등록</button></div>
            <div style="display:flex; gap:20px; flex-grow:1; overflow:hidden;">
                <div class="supplier-list-wrapper" style="flex:1; background:#fff; border:1px solid #ddd; border-radius:8px; display:flex; flex-direction:column;"><div style="padding:15px; border-bottom:1px solid #eee; background:#f9f9f9;"><input type="text" id="supplier-search" placeholder="검색..." style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;"></div><div id="supplier-list" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:8px;"><div style="text-align:center; padding:20px; color:#aaa;">로딩중...</div></div></div>
                <div class="supplier-detail-wrapper" style="width:400px; flex-shrink:0; background:#fff; border:1px solid #ddd; border-radius:8px; padding:20px; overflow-y:auto; display:flex; flex-direction:column;">
                    <h3 id="supplier-form-title" style="margin-bottom:20px; color:#333;">상세 정보</h3>
                    <div class="form-group" style="margin-bottom:15px;"><label style="display:block; font-weight:bold; margin-bottom:5px;">거래처명</label><input type="text" id="sup-name" style="width:100%; padding:8px; border:1px solid #ccc;"></div>
                    <div style="background:#f8f9fa; padding:15px; border-radius:6px; margin-bottom:15px;"><label style="display:block; font-weight:bold; margin-bottom:5px;">🌐 주문 사이트</label><input type="text" id="sup-website" placeholder="URL" style="width:100%; padding:8px; border:1px solid #ccc; margin-bottom:10px;"><div style="display:flex; gap:5px; margin-bottom:5px;"><input type="text" id="sup-site-id" placeholder="ID" style="flex:1; padding:8px; border:1px solid #ccc;"><button id="btn-toggle-pw" style="padding:0 10px; border:1px solid #ccc; background:#fff;">🔒</button></div><input type="password" id="sup-site-pw" placeholder="PW" style="width:100%; padding:8px; border:1px solid #ccc;"></div>
                    <div style="background:#f0f8ff; padding:15px; border:1px solid #b6d4fe; border-radius:6px; margin-bottom:15px;"><div style="display:flex; justify-content:space-between; margin-bottom:10px;"><label style="font-weight:bold; color:#0d6efd;">👤 현 담당자</label><button id="btn-manager-handover" style="font-size:0.75rem; padding:4px 8px; border:1px solid #0d6efd; background:#fff; color:#0d6efd;">🔄 이관</button></div><input type="text" id="sup-cur-manager" placeholder="이름" style="width:100%; padding:8px; margin-bottom:5px;"><input type="text" id="sup-cur-phone" placeholder="연락처" style="width:100%; padding:8px;"></div>
                    <div style="background:#eee; padding:15px; border-radius:6px; margin-bottom:20px;"><label style="display:block; font-weight:bold; color:#666; margin-bottom:5px;">🏚 이전 담당자</label><input type="text" id="sup-prev-manager" placeholder="이름" style="width:100%; padding:8px; margin-bottom:5px;"><input type="text" id="sup-prev-phone" placeholder="연락처" style="width:100%; padding:8px;"></div>
                    <div style="display:flex; gap:10px; margin-top:auto;"><button id="btn-save-supplier" style="flex:1; padding:12px; background:#27ae60; color:white; border:none; font-weight:bold;">저장</button><button id="btn-delete-supplier" style="padding:12px; background:#e74c3c; color:white; border:none;">삭제</button></div>
                </div>
            </div>
        </div>

        <div id="page-return-mgmt" class="content-group" style="display: none; padding: 20px; flex-grow: 1;"><h2>↩️ 반품 관리</h2><p>준비중...</p></div>

        <div id="page-product-mgmt" class="content-group" style="display: none; padding: 20px; flex-grow: 1; flex-direction:column; height: 100%; overflow: hidden;">
            <h2 style="margin-bottom:15px; border-bottom:2px solid #333; padding-bottom:10px; flex-shrink: 0;">🛠 상품 등록 및 관리</h2>
            <div style="display:flex; gap:20px; flex: 1; min-height: 0;">
                <div style="flex:1; background:#fff; border:1px solid #ccc; border-radius:8px; display:flex; flex-direction:column; overflow:hidden; max-width: 600px;">
                    <div style="padding: 20px; border-bottom:1px solid #eee; background-color:#fff;"><h3 style="margin:0;">새 상품 등록</h3></div>
                    <div id="product-form-body" style="flex:1; overflow-y:auto; padding: 20px; background-color:#fff;">
                        <div style="display:flex; flex-direction:column; gap:20px;">
                            <div><label style="font-weight:bold; display:block; margin-bottom:5px;">카테고리</label><select id="reg-category" style="width:100%; padding:10px; border:1px solid #ccc;"><option value="전문의약품">전문의약품</option><option value="일반의약품" selected>일반의약품</option><option value="의약외품">의약외품</option></select></div>
                            <div><label style="font-weight:bold; display:block; margin-bottom:5px;">제약회사</label><div style="display:flex; gap:8px;"><select id="reg-company" style="flex:1; padding:10px; border:1px solid #ccc;"><option value="">선택</option></select><button id="btn-quick-sup-open" style="padding:0 15px; background:#34495e; color:white; border:none;">+ 퀵등록</button></div></div>
                            <div><label style="font-weight:bold; display:block; margin-bottom:5px;">약품명</label><input type="text" id="reg-name" placeholder="예: 마이딜액 5%" style="width:100%; padding:10px; border:1px solid #ccc;"></div>
                            <div style="background:#f8f9fa; padding:15px; border-radius:8px; border:1px solid #e9ecef;"><label style="font-weight:bold; display:block; margin-bottom:10px;">주문 옵션 및 가격</label><div style="display:flex; gap:10px; margin-bottom:5px; color:#888;"><span style="flex:2;">옵션명</span><span style="flex:1;">가격</span><span style="width:35px;"></span></div><div id="reg-options-container" style="display:flex; flex-direction:column; gap:8px;"></div><button id="btn-add-option-row" style="width:100%; padding:8px; margin-top:10px; border:1px dashed #aaa; background:#fff;">+ 옵션 추가</button></div>
                            <div style="height: 10px;"></div>
                        </div>
                    </div>
                    <div style="padding: 15px 20px; border-top:1px solid #eee; background-color:#f9f9f9; flex-shrink:0; display:flex; gap:10px;">
                        <button id="btn-cancel-edit" style="flex:1; padding:12px; background:#95a5a6; color:white; border:none; cursor:pointer; border-radius:4px; font-weight:bold; display:none;">취소</button>
                        <button id="btn-register" style="flex:2; padding:12px; background:#27ae60; color:white; border:none; cursor:pointer; border-radius:4px; font-size:1.1rem; font-weight:bold;">상품 등록하기</button>
                    </div>
                </div>
                <div style="flex:1; background:#fff; border:1px solid #ccc; border-radius:8px; display:flex; flex-direction:column; overflow:hidden;">
                    <div style="padding:20px; border-bottom:1px solid #eee; background-color:#fff;"><h3 style="margin:0 0 10px 0;">등록된 상품 목록 <span id="admin-list-count" style="font-size:0.9rem; color:#888;"></span></h3><input type="text" id="admin-product-search" placeholder="검색..." style="width:100%; padding:10px; border:1px solid #ddd; background:#f9f9f9;"></div>
                    <div style="flex:1; overflow-y:auto; padding:0;"><ul id="admin-product-list" style="list-style:none; padding:0; margin:0;"><li style="color:#aaa; text-align:center; padding:20px;">로딩중...</li></ul></div>
                </div>
            </div>
        </div>

        <div id="page-settings" class="content-group" style="display: none; padding: 20px; flex-grow: 1;"><h2>⚙️ 설정</h2></div>
    </div>

    <section class="bottom-panel">
        <div class="panel-header"><span>📉 주문 처리 현황 (Log - 최근 72시간)</span><button id="toggle-btn">▼</button></div>
        <div id="completed-order-list" class="panel-content" style="display:flex; flex-direction:column; gap:5px;"><div id="log-empty-msg" style="color:#aaa; padding:10px;">기록 없음</div></div>
    </section>

    <footer class="bottom-footer"><div>System Status: Stable | Firebase Connected</div></footer>

    <div id="photo-viewer-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:99999; align-items:center; justify-content:center; flex-direction:column;">
        <div style="position:relative; max-width:90%; max-height:70%;">
            <img id="viewer-img" src="" style="max-width:100%; max-height:70vh; border-radius:8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
            <button id="viewer-close" style="position:absolute; top:-40px; right:0; background:none; border:none; color:white; font-size:2.5rem; cursor:pointer;">&times;</button>
        </div>
        <div id="viewer-note" style="background:rgba(255,255,255,0.9); padding:10px 20px; border-radius:20px; margin-top:15px; font-weight:bold; color:#333; max-width:90%; text-align:center;"></div>
        
        <div id="viewer-buttons" style="margin-top:15px; display:flex; gap:10px;"></div>
    </div>

    <div id="upload-confirm-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999999; align-items:center; justify-content:center; flex-direction:column;">
        <div style="background:white; padding:20px; border-radius:10px; width:90%; max-width:400px; text-align:center;">
            <h3>📸 사진 주문 요청</h3>
            <div style="margin:15px 0; max-height:300px; overflow:hidden; border-radius:8px; border:1px solid #eee;">
                <img id="upload-preview-img" src="" style="width:100%; height:auto; display:block;">
            </div>
            <textarea id="upload-note" placeholder="요청사항을 적어주세요 (예: 3개, 급함!)" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; height:80px; resize:none;"></textarea>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button id="btn-upload-cancel" style="padding:12px; background:#eee; border:none; border-radius:5px; flex:1;">취소</button>
                <button id="btn-upload-confirm" style="padding:12px; background:#27ae60; color:white; border:none; border-radius:5px; font-weight:bold; flex:1;">전송하기</button>
            </div>
        </div>
    </div>

    <div id="source-select-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:99999; align-items:flex-end; justify-content:center;">
        <div style="background:white; width:100%; max-width:500px; border-radius:20px 20px 0 0; padding:25px; animation: slideUp 0.3s ease-out;">
            <h3 style="margin-bottom:20px; text-align:center; color:#333;">사진 업로드 방식 선택</h3>
            <div style="display:flex; flex-direction:column; gap:15px;">
                <button id="btn-select-camera" style="padding:15px; font-size:1.1rem; background:#f8f9fa; border:2px solid #eee; border-radius:12px; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px;"><span>📸</span> 직접 촬영하기</button>
                <button id="btn-select-gallery" style="padding:15px; font-size:1.1rem; background:#f8f9fa; border:2px solid #eee; border-radius:12px; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px;"><span>🖼️</span> 앨범에서 선택</button>
                <button id="btn-select-cancel" style="padding:15px; font-size:1.1rem; background:#333; color:white; border:none; border-radius:12px; cursor:pointer; margin-top:10px;">취소</button>
            </div>
        </div>
    </div>

    <div id="info-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
        <div style="background:white; width:800px; height:80%; padding:30px; border-radius:8px; display:flex; flex-direction:column;"><div style="display:flex; justify-content:space-between; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;"><h3 style="font-size:1.5rem;">💊 약품 상세 정보</h3><button id="btn-close-modal" style="background:none; border:none; font-size:1.5rem;">&times;</button></div><div style="flex-grow:1; overflow-y:auto;"><p id="modal-content"></p></div><div style="margin-top:20px; text-align:right;"><button id="btn-close-modal-bottom" style="padding:10px 20px; background:#333; color:white; border:none;">닫기</button></div></div>
    </div>

    <div id="quick-sup-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:99999; align-items:center; justify-content:center;">
        <div style="background:white; width:350px; padding:25px; border-radius:8px;"><h3 style="margin-bottom:15px;">⚡ 거래처 퀵 등록</h3><input type="text" id="quick-sup-name" placeholder="거래처명" style="width:100%; padding:10px; border:1px solid #ccc; margin-bottom:15px;"><div style="display:flex; justify-content:flex-end; gap:10px;"><button id="btn-quick-sup-cancel" style="padding:8px 15px; background:#eee; border:none;">취소</button><button id="btn-quick-sup-save" style="padding:8px 15px; background:#2980b9; color:white; border:none;">등록</button></div></div>
    </div>

    <div id="loading-spinner" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999999; align-items:center; justify-content:center; flex-direction:column; color:white;">
        <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom:15px;"></div><div>처리 중...</div>
    </div>

    <input type="file" id="file-input-camera" accept="image/*" capture="environment" style="display:none;">
    <input type="file" id="file-input-gallery" accept="image/*" style="display:none;">
    <button id="btn-camera-floating" style="position:fixed; bottom:80px; right:20px; width:60px; height:60px; border-radius:50%; background:#e74c3c; color:white; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.3); font-size:2rem; cursor:pointer; z-index:9999; display:flex; align-items:center; justify-content:center;">📷</button>

    <script type="module" src="script.js"></script>
</body>
</html>